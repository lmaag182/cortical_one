<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <style>
            div.scroll
            {
                width:400px;
                height:300px;
                overflow:scroll;
            }
        </style>
        <title>cortical one</title>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js'></script>
        <script src="js/stomp.js"></script>
        <script>//<![CDATA[
            $(document).ready(function () {

                function stream(name) {
                    this.name = name;
                    this.records = [];
                    this.addRecord = function (content) {
                        if (this.records.unshift(content) > 9) {
                            this.records.pop();
                        }
                    }
                    this.getRecords = function () {
                        this.text = "";

                        for (index = 0; index < this.records.length; index++) {
                            this.text += this.records[index] + ";";
                        }
                        return this.text;
                    }
                }

                var node_id = "0005";
                var record = "";
                //var records = [];
                //var text = "";
                var streams = [];
                streams.push(new stream("s1"));
                $("#debug1").append(streams[0].name + "\n")
                var sendButtonValue = function (id) {
                    //alert(id);
                    client.send("/topic/node." + node_id + ".btn", {}, "btn;" + id + ";" + node_id);
                };
                if (window.WebSocket) {
                    var client, destination;
                    client = Stomp.client("ws://192.168.1.3:61623");
                    client.debug = function (str) {
                        $("#debug").append(str + "\n");
                        $("#debugScroll").scrollTop($("#debugScroll")[0].scrollHeight);
                    };
                    client.connect("admin", "password", function (frame) {
                        client.debug("connected to Stomp");
                        //client.send("/topic/announce.node.", {}, node_id);
                        //client.subscribe("/topic/UIup", function(message) {
                        //    $("#messages").text("Arduino is Ready");
                        //});
                        //client.subscribe("/topic/feedback.node." + node_id, function(message) {
                        //    $("#messages").text(message.body + message.destination);
                        //});
                        client.subscribe("/topic/node.*.*", function (message) {
                            //$("#messages").text(message.body);
                            record = message.body;
                            streamName = "";
                            streamName = record.split(";")[0] + "_" + record.split(";")[2];
                            streamValue = record.split(";")[1];
                            var currentStream = {};
                            //$("#messages").append(record.split(";")[1] + ";");
                            //check whether the stream exists
                            exists = false;
                            for (index = 0; index < streams.length; index++) {
                                //$("#debug1").append("checking:" + streamName + " against:" + streams[index].name+ "\n");
                                if (streams[index].name == streamName) {
                                    exists = true;
                                    currentStream = streams[index];
                                }
                            }


                            streamUIPath = "body > pre#streams > pre#" + streamName;
                            if (exists == false) {
                                currentStream = new stream(streamName);
                                streams.push(currentStream);
                                $("#debug1").append("added stream: " + streamName + "\n");
                                $("#streams").append("<pre id='" + streamName + "'></pre>");

                                $(streamUIPath).append("<div id='name'></div>");
                                $(streamUIPath).append("<div id='datar'></div>");
                                $(streamUIPath + " > div#name").append(streamName);
                                //append(streamName)
                            }
                            currentStream.addRecord(streamValue);
                            $(streamUIPath + " > div#datar").text(currentStream.getRecords());

                        });
                    });
                    $('#btn1').click(function () {
                        sendButtonValue(this.id);
                    });
                    $('#btn2').click(function () {
                        sendButtonValue(this.id);
                    });
                    $('#btn3').click(function () {
                        sendButtonValue(this.id);
                    });
                    $('#btn4').click(function () {
                        sendButtonValue(this.id);
                    });
                    $('#rst').click(function () {
                        sendButtonValue(this.id);
                    });
                } else {
                    $("#connect").html("\
                    <h1>Get a new Web Browser!</h1>\
                    <p>\
                    Your browser does not support WebSockets. This example will not work properly.<br>\
                    Please use a Web Browser with WebSockets support (WebKit or Google Chrome).\
                    </p>\
                    ");
                }
            });
            //]]></script>
    </head>
    <body>
        <pre id="streams"></pre>
        <div id="debugScroll" class="scroll"  style="float:right" >    
            <pre id="debug"></pre>
        </div>
        <table>
            <tr>
                <td>Button 1c</td><td><button type="button" id='btn1'>Set</button></td>
            </tr>            
            <tr>
                <td>Button 2</td><td><button type="button" id='btn2'>Set</button></td>
            </tr>            
            <tr>
                <td>Button 3</td><td><button type="button" id='btn3'>Set</button></td>
            </tr>            
            <tr>
                <td>Button 4</td><td><button type="button" id='btn4'>Set</button></td>
            </tr>
            <tr>
                <td>Reset</td><td><button type="button" id='rst'>Set</button></td><td><span id="messages"></span></td>
            </tr>
        </table>
        <pre id="debug1"></pre>

        <!--        <div id="debugScroll" class="scroll"  style="display: none;float:left" >-->

    </body>
</html>
